/* 导入自定义滚动条样式 */
@import url('./scrollbar.css');

body {
  margin: 0;
  font-family:
    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans',
    'Droid Sans', 'Helvetica Neue', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Semi Design 暗黑模式适配 */
body[theme-mode='dark'] .semi-always-light {
  color-scheme: light;
}

body[theme-mode='light'] .semi-always-dark {
  color-scheme: dark;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;
}

#root {
  width: 100%;
  height: 100vh;
}

.components-layout-demo {
  height: 100%;
}

/* 导航栏样式 */
.resize-handle {
  transition: background-color 0.2s;
}

.resize-handle:hover {
  background-color: var(--semi-color-primary-light-default) !important;
}

.secondary-nav {
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

/* 右键菜单样式 */
.context-menu-item {
  transition:
    background-color 0.2s,
    color 0.2s;
}

.context-menu-item:hover {
  background-color: var(--semi-color-primary-light-default);
}

.context-menu-item:hover svg {
  color: var(--semi-color-primary) !important;
}

.context-menu-item:hover .semi-typography {
  color: var(--semi-color-text-0) !important;
}

/* 删除按钮悬停时保持警告色 */
.context-menu-item:hover svg[data-icon='delete'] {
  color: var(--semi-color-danger) !important;
}

.context-menu-item:hover .semi-typography[style*='color: var(--semi-color-danger)'] {
  color: var(--semi-color-danger) !important;
}

/* 菜单分隔线 */
.context-menu-divider {
  height: 1px;
  background-color: var(--semi-color-border);
  margin: 4px 0;
}

/* 菜单危险操作项 */
.context-menu-item-danger:hover {
  background-color: var(--semi-color-danger-light-default) !important;
}

.context-menu {
  user-select: none;
}

/* 主题切换过渡效果 */
* {
  transition:
    background-color 0.3s ease,
    color 0.3s ease,
    border-color 0.3s ease;
}

/* 全局增强文本选择样式 */
::selection {
  background-color: var(--semi-color-primary-light-hover) !important;
  /* 选中高亮透明度 */
  opacity: 0.8 !important;
}

/* 确保 semi-portal-inner 显示在 data-floating-ui-focusable 的上层，但限制在对话界面内 */
.semi-portal-inner {
  z-index: 10050 !important; /* 设置一个比已有最高值 10000 更高的值 */
  isolation: isolate; /* 创建独立的堆叠上下文 */
  width: auto !important; /* 确保不会覆盖原有宽度 */
  height: auto !important; /* 确保不会覆盖原有高度 */
  max-width: calc(100vw - 32px) !important; /* 限制最大宽度，防止溢出视口 */
  max-height: calc(100vh - 32px) !important; /* 限制最大高度，防止溢出视口 */
  transform: none !important; /* 移除可能影响尺寸的变换 */
  will-change: auto; /* 使用默认值，避免创建额外的渲染层 */
  overflow: hidden !important; /* 防止内容溢出 */
  box-sizing: border-box !important; /* 确保边框和内边距包含在尺寸内 */
}

/* 当 semi-portal-inner 中包含弹出内容时，确保更高的优先级，但不影响尺寸 */
.semi-portal-inner .semi-popover-content,
.semi-portal-inner .semi-modal-content,
.semi-portal-inner .semi-dropdown-menu {
  z-index: 10051 !important;
  position: relative;
}

/* 针对 data-floating-ui-focusable 元素调整 z-index，确保不会遮挡弹出层 */
[data-floating-ui-focusable] {
  z-index: 1000 !important; /* 设置一个比 semi-portal-inner 低的值 */
}

/* 骨架屏全局样式增强 */
.skeleton-wrapper {
  animation: skeleton-loading 1.5s ease-in-out infinite alternate;
}

@keyframes skeleton-loading {
  0% {
    opacity: 0.8;
  }
  100% {
    opacity: 1;
  }
}

/* 骨架屏在暗色主题下的适配 */
body[theme-mode='dark'] .skeleton-wrapper {
  filter: brightness(0.9);
}

/* 确保骨架屏组件在加载时平滑过渡 */
.editor-skeleton,
.navigation-skeleton,
.data-analysis-skeleton,
.chart-skeleton {
  transition: opacity 0.3s ease-in-out;
}

/* 骨架屏加载完成后的淡出效果 */
.skeleton-fade-out {
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}

/* 聊天界面响应式设计 */
@media (max-width: 768px) {
  /* 小屏幕下隐藏RAG侧边栏或调整布局 */
  .chat-sidebar {
    display: none !important;
  }

  /* 确保聊天消息在小屏幕下正确换行 */
  .semi-chat-chatBox-content {
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    max-width: 100% !important;
  }

  /* 确保输入框在小屏幕下不溢出 */
  .semi-input,
  .semi-textarea {
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
}

@media (max-width: 480px) {
  /* 超小屏幕下进一步优化 */
  .chat-interface-container {
    padding: 8px !important;
  }

  /* 减少间距 */
  .chat-header {
    margin-bottom: 8px !important;
  }

  /* 确保标题不会溢出 */
  .semi-typography-h2 {
    font-size: 18px !important;
    word-break: break-word !important;
  }
}

/* 确保所有聊天相关元素都有适当的溢出控制 */
.semi-chat,
.semi-chat-chatBox,
.semi-chat-chatBox-content,
.semi-chat-inputArea {
  overflow: hidden !important;
  word-break: break-word !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
}

/* 确保提示信息不会溢出 */
.semi-chat-chatBox-content .semi-tag,
.semi-chat-chatBox-content .semi-tooltip,
.semi-chat-chatBox-content .semi-typography {
  max-width: 100% !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  word-break: break-word !important;
}

/* 专门针对聊天界面内的弹出层控制 */
.chat-interface-container .semi-portal-inner,
.chat-interface-container .semi-popover-content,
.chat-interface-container .semi-tooltip-content,
.chat-interface-container .semi-dropdown-menu {
  max-width: calc(100vw - 64px) !important; /* 考虑聊天界面的padding */
  max-height: calc(100vh - 64px) !important;
  overflow: hidden !important;
  word-break: break-word !important;
  box-sizing: border-box !important;
}

/* 确保聊天界面内的弹出层不会超出边界 */
.chat-interface-container .semi-tooltip {
  max-width: 300px !important;
  word-break: break-word !important;
}

.chat-interface-container .semi-tooltip-content {
  max-width: 300px !important;
  word-break: break-word !important;
  overflow-wrap: break-word !important;
}

/* 限制RAG来源标签的弹出提示 */
.chat-interface-container .semi-tag .semi-tooltip-content {
  max-width: 250px !important;
  max-height: 200px !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
}

/* 全局弹出层容器控制 - 智能边缘处理 */
body .semi-portal-inner {
  /* 确保弹出层不会超出视口，但保持可见性 */
  position: fixed !important;
  max-width: calc(100vw - 32px) !important;
  max-height: calc(100vh - 32px) !important;
  overflow: visible !important; /* 改为visible，让内容可以调整位置 */
  box-sizing: border-box !important;
  z-index: 10050 !important;
}

/* 智能边缘检测 - 当弹出层接近边缘时自动调整 */
body .semi-portal-inner[data-popper-placement*="top"] {
  /* 顶部弹出时，确保不会超出顶部边界 */
  max-width: min(350px, calc(100vw - 32px)) !important;
  max-height: min(250px, calc(100vh - 100px)) !important;
  transform-origin: bottom center !important;
}

body .semi-portal-inner[data-popper-placement*="bottom"] {
  /* 底部弹出时，确保不会超出底部边界 */
  max-width: min(350px, calc(100vw - 32px)) !important;
  max-height: min(250px, calc(100vh - 100px)) !important;
  transform-origin: top center !important;
}

body .semi-portal-inner[data-popper-placement*="left"] {
  /* 左侧弹出时，确保不会超出左边界 */
  max-width: min(300px, calc(100vw - 100px)) !important;
  max-height: min(200px, calc(100vh - 32px)) !important;
  transform-origin: center right !important;
}

body .semi-portal-inner[data-popper-placement*="right"] {
  /* 右侧弹出时，确保不会超出右边界 */
  max-width: min(300px, calc(100vw - 100px)) !important;
  max-height: min(200px, calc(100vh - 32px)) !important;
  transform-origin: center left !important;
}

/* 特别处理Tooltip内容 - 增强可见性 */
body .semi-tooltip-content {
  max-width: min(280px, calc(100vw - 48px)) !important;
  max-height: min(180px, calc(100vh - 48px)) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  word-break: break-word !important;
  overflow-wrap: break-word !important;
  padding: 8px 12px !important;
  line-height: 1.4 !important;
  font-size: 12px !important;
  background: rgba(0, 0, 0, 0.85) !important;
  color: white !important;
  border-radius: 6px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

/* 确保Select下拉菜单不会溢出 */
body .semi-select-option-list {
  max-width: calc(100vw - 32px) !important;
  max-height: calc(100vh - 100px) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
}

/* 聊天界面容器的弹出层约束 */
.chat-interface-container {
  /* 创建一个包含块，限制弹出层的定位范围 */
  position: relative !important;
  contain: layout style !important;
}

/* 为聊天界面内的弹出层提供更好的定位 */
.chat-interface-container .semi-tooltip {
  /* 使用相对定位确保在容器内 */
  position: relative !important;
}

/* 强制弹出层在视口内显示 */
body .semi-portal-inner {
  /* 使用CSS的clamp函数确保位置在合理范围内 */
  left: clamp(8px, var(--popper-x, 50%), calc(100vw - 8px)) !important;
  top: clamp(8px, var(--popper-y, 50%), calc(100vh - 8px)) !important;
  right: auto !important;
  bottom: auto !important;
}

/* 针对不同方向的弹出层进行优化 */
body .semi-portal-inner[data-popper-placement^="top"] {
  transform: translateY(-100%) !important;
  margin-bottom: 8px !important;
}

body .semi-portal-inner[data-popper-placement^="bottom"] {
  transform: translateY(0%) !important;
  margin-top: 8px !important;
}

body .semi-portal-inner[data-popper-placement^="left"] {
  transform: translateX(-100%) !important;
  margin-right: 8px !important;
}

body .semi-portal-inner[data-popper-placement^="right"] {
  transform: translateX(0%) !important;
  margin-left: 8px !important;
}

/* 确保弹出层内容始终可见 */
body .semi-tooltip-content,
body .semi-popover-content {
  /* 添加最小可见区域保证 */
  min-width: 120px !important;
  min-height: 24px !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}
